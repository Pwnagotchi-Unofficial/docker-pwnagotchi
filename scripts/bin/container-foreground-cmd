#!/bin/sh

set -eu

# Initialize Pwnagotchi config from template
if [ -e /etc/pwnagotchi/config.tmpl.yml ]; then
	envsubst < /etc/pwnagotchi/config.tmpl.yml > /etc/pwnagotchi/config.yml
fi

# Initialize Bettercap caplets from templates
if [ -e /usr/local/share/bettercap/caplets/pwnagotchi-auto.tmpl.cap ]; then
	envsubst < /usr/local/share/bettercap/caplets/pwnagotchi-auto.tmpl.cap > /usr/local/share/bettercap/caplets/pwnagotchi-auto.cap
fi
if [ -e /usr/local/share/bettercap/caplets/pwnagotchi-manual.tmpl.cap ]; then
	envsubst < /usr/local/share/bettercap/caplets/pwnagotchi-manual.tmpl.cap > /usr/local/share/bettercap/caplets/pwnagotchi-manual.cap
fi

# Start all services
exec runsvdir -P /etc/service/
